<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>HawkTracer: Tutorial: Define custom timeline feature</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">HawkTracer
   &#160;<span id="projectnumber">0.10.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('tutorial_define_timeline_feature.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Tutorial: Define custom timeline feature </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>In this tutorial we will learn how to extend timeline capabilities by defining custom timeline features.</p>
<h2>Before you start...</h2>
<p>We recommend you to go through the <a class="el" href="tutorial_hello_world.html">Tutorial: Hello world!</a> tutorial to make sure you have the HawkTracer library properly installed.</p>
<h2>Problem statement</h2>
<p>We'd like to know how many events we pushed to a specific timeline object.</p>
<h2>Code</h2>
<p>Please copy the text below to a files named <code>hawktracer-custom-timeline-feature.c</code>, <code>push-counter-feature.c</code> and <code>push-counter-feature.h</code> (you can find those files <a href="https://github.com/amzn/hawktracer/tree/master//examples/tutorials/custom_timeline_feature/">in the repository as well</a>).</p>
<p><b>hawktracer-custom-timeline-feature.c</b> </p><div class="fragment"><div class="line"></div><div class="line"><span class="comment">/* Contains declaration of custome feature&#39;s API */</span></div><div class="line"><span class="preprocessor">#include &quot;push-counter-feature.h&quot;</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="hawktracer_8h.html">hawktracer.h</a>&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>** argv)</div><div class="line">{</div><div class="line">    <span class="comment">/* initialize HawkTracer library */</span></div><div class="line">    <a class="code" href="init_8h.html#ace9a4e991b289c1a887b74aa4cba2036">ht_init</a>(argc, argv);</div><div class="line"></div><div class="line">    <span class="comment">/* register our custom feature */</span></div><div class="line">    PushCounterFeature_register();</div><div class="line"></div><div class="line">    <a class="code" href="base__types_8h.html#a33d648be4499dad0fed381138f28b6a2">HT_ErrorCode</a> error_code;</div><div class="line">    <span class="comment">/* create timeline object. Instead, global timeline could be used (ht_global_timeline_get()) */</span></div><div class="line">    <a class="code" href="timeline_8h.html#a9fbfe949ba846a39b58edb008ee0b93f">HT_Timeline</a>* timeline = <a class="code" href="timeline_8h.html#ac43f980d516953937da0b5d45f39b02b">ht_timeline_create</a>(1024, <a class="code" href="base__types_8h.html#af93826a1cb5919418789425c8b9a823e">HT_FALSE</a>, <a class="code" href="base__types_8h.html#af93826a1cb5919418789425c8b9a823e">HT_FALSE</a>, NULL, &amp;error_code);</div><div class="line">    <span class="keywordflow">if</span> (!timeline)</div><div class="line">    {</div><div class="line">        printf(<span class="stringliteral">&quot;Failed to create timeline object: %d\n&quot;</span>, error_code);</div><div class="line">        <span class="keywordflow">return</span> 1;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="comment">/* attach the feature to the timeline object */</span></div><div class="line">    push_counter_feature_enable(timeline);</div><div class="line"></div><div class="line">    <span class="comment">/* push 10 events to the timeline through the feature method */</span></div><div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 10; i++)</div><div class="line">    {</div><div class="line">        <a class="code" href="events_8h.html#a01c194e82a354cc3ce5817ce135afa03">HT_DECL_EVENT</a>(<a class="code" href="core__events_8h.html#a3be287cc2d8758bb9f700a63aa45a543">HT_Event</a>, event)</div><div class="line">        push_counter_feature_push_event(timeline, &amp;event);</div><div class="line">    }</div><div class="line"></div><div class="line">    printf(<span class="stringliteral">&quot;Number of events pushed to the timeline: %d\n&quot;</span>,</div><div class="line">           push_counter_feature_get_count(timeline));</div><div class="line"></div><div class="line">    <span class="comment">/* destroy the timeline. It will also destroy the feature */</span></div><div class="line">    <a class="code" href="timeline_8h.html#ac6c15a5745921fb4ad192d69941a6169">ht_timeline_destroy</a>(timeline);</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">}</div></div><!-- fragment --><p><b>push-counter-feature.h</b> </p><div class="fragment"><div class="line"></div><div class="line"><span class="preprocessor">#ifndef PUSH_COUNTER_FEATURE_H</span></div><div class="line"><span class="preprocessor">#define PUSH_COUNTER_FEATURE_H</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="hawktracer_8h.html">hawktracer.h</a>&gt;</span></div><div class="line"></div><div class="line"><a class="code" href="macros_8h.html#a72cdb842abe63cf67271f3ff590b66bc">HT_DECLS_BEGIN</a></div><div class="line"></div><div class="line"><span class="comment">/*</span></div><div class="line"><span class="comment"> * Registers feature in HawkTracer system.</span></div><div class="line"><span class="comment"> * The definition of the function is automatically generated</span></div><div class="line"><span class="comment"> * by HT_FEATURE_DEFINE() macro.</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><a class="code" href="base__types_8h.html#a33d648be4499dad0fed381138f28b6a2">HT_ErrorCode</a> PushCounterFeature_register(<span class="keywordtype">void</span>);</div><div class="line"></div><div class="line"><span class="comment">/*</span></div><div class="line"><span class="comment"> * Helper method for enabling a feature for a specific timeline object</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><a class="code" href="base__types_8h.html#a33d648be4499dad0fed381138f28b6a2">HT_ErrorCode</a> push_counter_feature_enable(<a class="code" href="timeline_8h.html#a9fbfe949ba846a39b58edb008ee0b93f">HT_Timeline</a>* timeline);</div><div class="line"></div><div class="line"><span class="comment">/*</span></div><div class="line"><span class="comment"> * Feature method - pushes an event to a timeline and increments the counter.</span></div><div class="line"><span class="comment"> * The method is a wrapper for ht_timeline_push_event()</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keywordtype">void</span> push_counter_feature_push_event(<a class="code" href="timeline_8h.html#a9fbfe949ba846a39b58edb008ee0b93f">HT_Timeline</a>* timeline, <a class="code" href="core__events_8h.html#a3be287cc2d8758bb9f700a63aa45a543">HT_Event</a>* event);</div><div class="line"></div><div class="line"><span class="comment">/*</span></div><div class="line"><span class="comment"> * Feature method - returns count of events pushed to the timeline</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keywordtype">int</span> push_counter_feature_get_count(<a class="code" href="timeline_8h.html#a9fbfe949ba846a39b58edb008ee0b93f">HT_Timeline</a>* timeline);</div><div class="line"></div><div class="line"><a class="code" href="macros_8h.html#a52ef69cf4fd2ec11ec19e11d0de84c24">HT_DECLS_END</a></div><div class="line"></div><div class="line"><span class="preprocessor">#endif </span><span class="comment">/* PUSH_COUNTER_FEATURE_H */</span><span class="preprocessor"></span></div></div><!-- fragment --><p><b>push-counter-feature.c</b> </p><div class="fragment"><div class="line"></div><div class="line"><span class="preprocessor">#include &quot;push-counter-feature.h&quot;</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div><div class="line"></div><div class="line"><span class="comment">/* feature object. This should contain all fields that will be used</span></div><div class="line"><span class="comment"> * by the feature methods */</span></div><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span></div><div class="line">{</div><div class="line">    <span class="comment">/* required field - the feature must inherit from HT_Feature class */</span></div><div class="line">    <a class="code" href="feature_8h.html#a72209c3c8e0f9e51403b30c1ba29b2ec">HT_Feature</a> base;</div><div class="line">    <span class="comment">/* other feature members go here. we&#39;ll be using count field for</span></div><div class="line"><span class="comment">     * counting number of events being pushed to the timeline</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="keywordtype">int</span> counter;</div><div class="line">} PushCounterFeature;</div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> push_counter_feature_destroy(<a class="code" href="feature_8h.html#a72209c3c8e0f9e51403b30c1ba29b2ec">HT_Feature</a>* feature);</div><div class="line"></div><div class="line"><span class="comment">/* the macro defines a few helper methods for the feature.</span></div><div class="line"><span class="comment"> * All the methods are prefixed with PushCounterFeature_</span></div><div class="line"><span class="comment">*/</span></div><div class="line"><a class="code" href="feature_8h.html#a0e01d98198b643067231802a2f907132">HT_FEATURE_DEFINE</a>(PushCounterFeature, push_counter_feature_destroy)</div><div class="line"></div><div class="line"><span class="comment">/* A helper method for attaching the feature to the timeline.</span></div><div class="line"><span class="comment"> * User can simply call this function with her timeline object</span></div><div class="line"><span class="comment"> * as a parameter to enable the feature for that timeline</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><a class="code" href="base__types_8h.html#a33d648be4499dad0fed381138f28b6a2">HT_ErrorCode</a> push_counter_feature_enable(<a class="code" href="timeline_8h.html#a9fbfe949ba846a39b58edb008ee0b93f">HT_Timeline</a>* timeline)</div><div class="line">{</div><div class="line">    <span class="comment">/* Allocate memory for the feature. This method should be used for</span></div><div class="line"><span class="comment">     * allocating the object, as it not only allocates memory, but</span></div><div class="line"><span class="comment">     * initializes base HT_Feature member.</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    PushCounterFeature* feature = PushCounterFeature_alloc();</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (feature == NULL)</div><div class="line">    {</div><div class="line">        <span class="keywordflow">return</span> <a class="code" href="base__types_8h.html#a33d648be4499dad0fed381138f28b6a2a8c326508d21bdb4620d20e6a70640248">HT_ERR_OUT_OF_MEMORY</a>;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="comment">/* Initialize all the fields of the feature. In this case, we reset the counter */</span></div><div class="line">    feature-&gt;counter = 0;</div><div class="line"></div><div class="line">    <span class="comment">/* The function attaches the feature to a timeline */</span></div><div class="line">    <span class="keywordflow">return</span> <a class="code" href="timeline_8h.html#a230989a0afde8f4cb4d2c9d5de471519">ht_timeline_set_feature</a>(timeline, (<a class="code" href="feature_8h.html#a72209c3c8e0f9e51403b30c1ba29b2ec">HT_Feature</a>*)feature);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> push_counter_feature_push_event(<a class="code" href="timeline_8h.html#a9fbfe949ba846a39b58edb008ee0b93f">HT_Timeline</a>* timeline, <a class="code" href="core__events_8h.html#a3be287cc2d8758bb9f700a63aa45a543">HT_Event</a>* event)</div><div class="line">{</div><div class="line">    <span class="comment">/* Obtain the feature from the timeline */</span></div><div class="line">    PushCounterFeature* feature = PushCounterFeature_from_timeline(timeline);</div><div class="line"></div><div class="line">    <span class="comment">/* The feature might not be enabled for the pipeline, so this needs to be checked. */</span></div><div class="line">    <span class="keywordflow">if</span> (!feature)</div><div class="line">    {</div><div class="line">        printf(<span class="stringliteral">&quot;Feature has not been enabled for the pipeline\n&quot;</span>);</div><div class="line">        <span class="keywordflow">return</span>;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="comment">/* Perform the feature&#39;s logic */</span></div><div class="line">    <a class="code" href="timeline_8h.html#a372a26ed4b2e5512eed0f2bb990819d6">ht_timeline_push_event</a>(timeline, event);</div><div class="line">    feature-&gt;counter++;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> push_counter_feature_get_count(<a class="code" href="timeline_8h.html#a9fbfe949ba846a39b58edb008ee0b93f">HT_Timeline</a>* timeline)</div><div class="line">{</div><div class="line">    <span class="comment">/* Obtain the feature from the timeline */</span></div><div class="line">    PushCounterFeature* feature = PushCounterFeature_from_timeline(timeline);</div><div class="line"></div><div class="line">    <span class="comment">/* The feature might not be enabled for the pipeline, so this needs to be checked. */</span></div><div class="line">    <span class="keywordflow">if</span> (!feature)</div><div class="line">    {</div><div class="line">        <span class="keywordflow">return</span> -1;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> feature-&gt;counter;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">/* Destroys the feature object */</span></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> push_counter_feature_destroy(<a class="code" href="feature_8h.html#a72209c3c8e0f9e51403b30c1ba29b2ec">HT_Feature</a>* feature)</div><div class="line">{</div><div class="line">    PushCounterFeature* push_counter_feature = (PushCounterFeature*)feature;</div><div class="line"></div><div class="line">    <span class="comment">/* Here all the resources of the feature should be released */</span></div><div class="line"></div><div class="line">    <a class="code" href="alloc_8h.html#a585fcf29e23cc074acebd81c97fe2ba4">ht_free</a>(push_counter_feature);</div><div class="line">}</div></div><!-- fragment --><h2>Walkthrough</h2>
<p>We assume you already went through the <a class="el" href="tutorial_hello_world.html">Tutorial: Hello world!</a> tutorial, so we only focus here on the new part.</p>
<h3>Defining the feature</h3>
<p>We start with defining the feature.</p>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span></div><div class="line">{</div><div class="line">    <a class="code" href="feature_8h.html#a72209c3c8e0f9e51403b30c1ba29b2ec">HT_Feature</a> base;</div><div class="line">    <span class="keywordtype">int</span> counter;</div><div class="line">} PushCounterFeature;</div><div class="line"></div><div class="line"><a class="code" href="feature_8h.html#a0e01d98198b643067231802a2f907132">HT_FEATURE_DEFINE</a>(PushCounterFeature, push_counter_feature_destroy)</div></div><!-- fragment --><p> First, we define the structure that holds all the required information about the feature. We agreed that we want to count number of events being pushed to a timeline, therefore we need a <code>counter</code> field. All the features must inherit from <code>HT_Feature</code> class, so we need to create <code>base</code> field of this type as a first one in the structure.</p>
<p><a class="el" href="feature_8h.html#a0e01d98198b643067231802a2f907132" title="Defines a set of methods that help defining timeline feature. ">HT_FEATURE_DEFINE()</a> is a helper macro that defines a few helper methods which we use in the implementation. It takes struct name and destroy callback.</p>
<div class="fragment"><div class="line"><a class="code" href="base__types_8h.html#a33d648be4499dad0fed381138f28b6a2">HT_ErrorCode</a> push_counter_feature_enable(<a class="code" href="timeline_8h.html#a9fbfe949ba846a39b58edb008ee0b93f">HT_Timeline</a>* timeline)</div></div><!-- fragment --><p> We'd like the feature to be easily accessible to our users (including ourselves), so we define <code>push_counter_feature_enable()</code> that will be used to enable the feature for a specific timeline. As enabling feature might fail because of many reasons, we return HT_ErrorCode to inform our users about exact problem.</p>
<div class="fragment"><div class="line">PushCounterFeature* feature = PushCounterFeature_alloc();</div></div><!-- fragment --><p> We allocate an instance of the object using <code>PushCounterFeature_alloc()</code> method - the method was auto-generated by <a class="el" href="feature_8h.html#a0e01d98198b643067231802a2f907132" title="Defines a set of methods that help defining timeline feature. ">HT_FEATURE_DEFINE()</a>. It allocates memory (using <a class="el" href="alloc_8h.html#afc07b3e61043002339ab5aef3e324db8" title="Allocates memory using HawkTracer allocator. ">ht_alloc()</a>) but also initializes the <code>base</code> field of the structure. If you want to use allocation method different than <a class="el" href="alloc_8h.html#afc07b3e61043002339ab5aef3e324db8" title="Allocates memory using HawkTracer allocator. ">ht_alloc()</a>, you need to make sure that you initialize the structure on your own.</p>
<div class="fragment"><div class="line"><span class="keywordflow">if</span> (feature == NULL)</div><div class="line">{</div><div class="line">    <span class="keywordflow">return</span> <a class="code" href="base__types_8h.html#a33d648be4499dad0fed381138f28b6a2a8c326508d21bdb4620d20e6a70640248">HT_ERR_OUT_OF_MEMORY</a>;</div><div class="line">}</div></div><!-- fragment --><p> Allocating the feature might fail, so we need to handle this scenario correctly.</p>
<div class="fragment"><div class="line">feature-&gt;counter = 0;</div></div><!-- fragment --><p> We need to initialize the data structure. In our case, it means reseting the counter value.</p>
<div class="fragment"><div class="line"><span class="keywordflow">return</span> <a class="code" href="timeline_8h.html#a230989a0afde8f4cb4d2c9d5de471519">ht_timeline_set_feature</a>(timeline, (<a class="code" href="feature_8h.html#a72209c3c8e0f9e51403b30c1ba29b2ec">HT_Feature</a>*)feature);</div></div><!-- fragment --><p> When the feature is initialized, we can attach it to the timeline, using ht_timeline_set_feature. From now on, the timeline manages the memory of the feature (even if the function doesn't complete successfully, it will still release the feature). </p><div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> push_counter_feature_destroy(<a class="code" href="feature_8h.html#a72209c3c8e0f9e51403b30c1ba29b2ec">HT_Feature</a>* feature)</div><div class="line">{</div><div class="line">    PushCounterFeature* push_counter_feature = (PushCounterFeature*)feature;</div><div class="line">    <a class="code" href="alloc_8h.html#a585fcf29e23cc074acebd81c97fe2ba4">ht_free</a>(push_counter_feature);</div><div class="line">}</div></div><!-- fragment --><p> We also need to define a method for destroying the feature. As mentioned above, by default <a class="el" href="namespace_hawk_tracer.html">HawkTracer</a> uses <a class="el" href="alloc_8h.html#afc07b3e61043002339ab5aef3e324db8" title="Allocates memory using HawkTracer allocator. ">ht_alloc()</a> method for allocating the memory for the object, therefore we use <a class="el" href="alloc_8h.html#a585fcf29e23cc074acebd81c97fe2ba4" title="Releases memory allocated by ht_alloc. ">ht_free()</a> for releasing it. If the feature object allocated additional resources, the method is a right place to release them.</p>
<h3>Defining the feature logic</h3>
<p>We defined the feature, but without the logic implemented for the feature, it's kind of useless. </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> push_counter_feature_push_event(<a class="code" href="timeline_8h.html#a9fbfe949ba846a39b58edb008ee0b93f">HT_Timeline</a>* timeline, <a class="code" href="core__events_8h.html#a3be287cc2d8758bb9f700a63aa45a543">HT_Event</a>* event)</div></div><!-- fragment --><p> We'll define a method which will push an event to a timeline, and at the same time increase the counter of the feature.</p>
<div class="fragment"><div class="line">PushCounterFeature* feature = PushCounterFeature_from_timeline(timeline);</div></div><!-- fragment --><p> Please note we don't pass the feature as an argument to the function. In order to get it, HT_DEFINE_FEATURE() generates <code>PushCounterFeature_from_timeline()</code> function that gets the feature from the timeline.</p>
<div class="fragment"><div class="line"><span class="keywordflow">if</span> (!feature)</div><div class="line">{</div><div class="line">    printf(<span class="stringliteral">&quot;Feature has not been enabled for the pipeline\n&quot;</span>);</div><div class="line">    <span class="keywordflow">return</span>;</div><div class="line">}</div></div><!-- fragment --><p> The timeline being passed to the function might not have this feature enabled, so we need to check that before executing the logic.</p>
<div class="fragment"><div class="line"><a class="code" href="timeline_8h.html#a372a26ed4b2e5512eed0f2bb990819d6">ht_timeline_push_event</a>(timeline, event);</div><div class="line">feature-&gt;counter++;</div></div><!-- fragment --><p> This is the actual logic of the feature - we push the event to the timeline, and increment the counter.</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> push_counter_feature_get_count(<a class="code" href="timeline_8h.html#a9fbfe949ba846a39b58edb008ee0b93f">HT_Timeline</a>* timeline)</div><div class="line">{</div><div class="line">    PushCounterFeature* feature = PushCounterFeature_from_timeline(timeline);</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (!feature)</div><div class="line">    {</div><div class="line">        <span class="keywordflow">return</span> -1;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> feature-&gt;counter;</div><div class="line">}</div></div><!-- fragment --><p> We also define a simple method for returning the counter to the user.</p>
<h3>Declaring interface of the feature</h3>
<p>In the previous paragraph we defined the feature. Now, we need to expose an interface to the user so she can use it in her code.</p>
<div class="fragment"><div class="line"><a class="code" href="base__types_8h.html#a33d648be4499dad0fed381138f28b6a2">HT_ErrorCode</a> PushCounterFeature_register(<span class="keywordtype">void</span>);</div><div class="line"></div><div class="line"><a class="code" href="base__types_8h.html#a33d648be4499dad0fed381138f28b6a2">HT_ErrorCode</a> push_counter_feature_enable(<a class="code" href="timeline_8h.html#a9fbfe949ba846a39b58edb008ee0b93f">HT_Timeline</a>* timeline);</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> push_counter_feature_get_count(<a class="code" href="timeline_8h.html#a9fbfe949ba846a39b58edb008ee0b93f">HT_Timeline</a>* timeline);</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> push_counter_feature_push_event(<a class="code" href="timeline_8h.html#a9fbfe949ba846a39b58edb008ee0b93f">HT_Timeline</a>* timeline, <a class="code" href="core__events_8h.html#a3be287cc2d8758bb9f700a63aa45a543">HT_Event</a>* event);</div></div><!-- fragment --><p> Apart from the three methods we defined in the previous paragraph, there's one extra method we expose to users: <code>HT_ErrorCode PushCounterFeature_register()</code> - we didn't implement the function, but it was auto-generated by HT_DEFINE_FEATURE(). The feature must be registered before usage, so we need to expose the function so she can register it at any time in her code.</p>
<p>### Using the feature in the code </p><div class="fragment"><div class="line">PushCounterFeature_register();</div></div><!-- fragment --><p> Before we start, the feature must be registered. The function should be called after <a class="el" href="init_8h.html#ace9a4e991b289c1a887b74aa4cba2036" title="Initializes HawkTracer library. ">ht_init()</a>, but before any usage of the feature.</p>
<div class="fragment"><div class="line">push_counter_feature_enable(timeline);</div></div><!-- fragment --><p> We enable the feature for the timeline. We defined a nice function that wraps all the initializations, so our user needs to call only one function to attach the feature to the timeline.</p>
<div class="fragment"><div class="line">push_counter_feature_push_event(timeline, &amp;event);</div></div><!-- fragment --><p> Instead of using <a class="el" href="timeline_8h.html#a372a26ed4b2e5512eed0f2bb990819d6" title="Pushes an event to a timeline. ">ht_timeline_push_event()</a> function, we use function defined for our feature, so we can keep track of number of events being pushed to the timeline.</p>
<div class="fragment"><div class="line">printf(<span class="stringliteral">&quot;Number of events pushed to the timeline: %d\n&quot;</span>,</div><div class="line">       push_counter_feature_get_count(timeline));</div></div><!-- fragment --><p> At the end of the program we print the count, so we now how many events we pushed to the timeline.</p>
<div class="fragment"><div class="line"><a class="code" href="timeline_8h.html#ac6c15a5745921fb4ad192d69941a6169">ht_timeline_destroy</a>(timeline);</div></div><!-- fragment --><p> There's no need for destroying the feature - timeline destructor takes care of releasing the object by calling <code>push_counter_feature_destroy()</code> function.</p>
<h3>Program output</h3>
<p>After running the program, you should see the following output on the screen: </p><div class="fragment"><div class="line">$ ./custom-timeline-feature </div><div class="line">Number of events pushed to the timeline: 10</div></div><!-- fragment --> </div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="index.html">index</a></li><li class="navelem"><a class="el" href="tutorials.html">Tutorials</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
